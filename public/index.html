<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Headline</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', sans-serif;
      background: #fff;
      color: #1d1d1f;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 60px 24px;
    }

    /* Location row - centered */
    .location-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 48px;
    }

    .location-label {
      font-size: 15px;
      color: #86868b;
      font-weight: 400;
    }

    .country-wrapper {
      position: relative;
      display: inline-flex;
      align-items: center;
    }

    .country-select {
      font-size: 15px;
      font-weight: 600;
      color: #1d1d1f;
      background: transparent;
      border: none;
      cursor: pointer;
      padding: 4px 20px 4px 0;
      -webkit-appearance: none;
      appearance: none;
    }

    .country-select:focus {
      outline: none;
    }

    .chevron {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
      width: 10px;
      height: 10px;
      border-right: 2px solid #86868b;
      border-bottom: 2px solid #86868b;
      transform: translateY(-60%) rotate(45deg);
    }

    /* Headline section - centered */
    .headline-section {
      text-align: center;
      margin-bottom: 48px;
    }

    .headline-display {
      font-size: 56px;
      font-weight: 600;
      line-height: 1.05;
      letter-spacing: -0.025em;
      margin-bottom: 40px;
      min-height: 64px;
    }

    .headline-display.placeholder {
      color: #86868b;
    }

    /* Input - minimal underline style */
    .input-row {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      max-width: 480px;
      margin: 0 auto;
    }

    .input-wrapper {
      width: 100%;
      position: relative;
    }

    .headline-input {
      width: 100%;
      font-size: 20px;
      font-family: inherit;
      padding: 12px 0;
      border: none;
      border-bottom: 2px solid #d2d2d7;
      background: transparent;
      color: #1d1d1f;
      text-align: center;
      transition: border-color 0.2s;
      caret-color: #1d1d1f;
    }

    .headline-input::placeholder {
      color: #86868b;
    }

    .headline-input:focus {
      outline: none;
      border-bottom-color: #1d1d1f;
    }

    .submit-btn {
      font-size: 17px;
      font-weight: 500;
      font-family: inherit;
      padding: 14px 32px;
      background: #1d1d1f;
      color: #fff;
      border: none;
      border-radius: 980px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
      white-space: nowrap;
    }

    .submit-btn:hover {
      background: #000;
    }

    .submit-btn:active {
      transform: scale(0.98);
    }

    .submit-btn:disabled {
      background: #86868b;
      cursor: not-allowed;
      transform: none;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: #e8e8ed;
      margin: 48px 0;
    }

    /* Recent section */
    .recent-section {
      max-width: 480px;
      margin: 0 auto;
    }

    .recent-section h2 {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #86868b;
      margin-bottom: 20px;
      text-align: center;
    }

    .recent-list {
      list-style: none;
    }

    .recent-item {
      padding: 14px 0;
      border-bottom: 1px solid #f5f5f7;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
    }

    .recent-item:last-child {
      border-bottom: none;
    }

    .recent-content {
      flex: 1;
      min-width: 0;
    }

    .recent-headline {
      font-size: 15px;
      font-weight: 500;
      line-height: 1.4;
    }

    .recent-time {
      font-size: 13px;
      color: #86868b;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .empty-state {
      color: #86868b;
      font-size: 15px;
      text-align: center;
      padding: 24px 0;
    }

    /* Toast */
    .status-toast {
      position: fixed;
      bottom: 32px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: #1d1d1f;
      color: #fff;
      padding: 14px 28px;
      border-radius: 980px;
      font-size: 15px;
      font-weight: 500;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      pointer-events: none;
    }

    .status-toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Tablet */
    @media (max-width: 768px) {
      .container {
        padding: 48px 24px;
      }

      .headline-display {
        font-size: 44px;
        margin-bottom: 36px;
      }

      .headline-input {
        font-size: 18px;
      }
    }

    /* Mobile */
    @media (max-width: 480px) {
      .container {
        padding: 40px 20px;
      }

      .location-row {
        margin-bottom: 36px;
      }

      .location-label {
        font-size: 14px;
      }

      .country-select {
        font-size: 14px;
      }

      .headline-display {
        font-size: 32px;
        min-height: 40px;
        margin-bottom: 32px;
      }

      .headline-input {
        font-size: 17px;
        padding: 10px 0;
      }

      .submit-btn {
        width: 100%;
        padding: 16px 32px;
      }

      .divider {
        margin: 40px 0;
      }

      .recent-item {
        padding: 12px 0;
      }

      .recent-headline {
        font-size: 14px;
      }

      .recent-time {
        font-size: 12px;
      }

      .status-toast {
        bottom: 24px;
        left: 20px;
        right: 20px;
        transform: translateX(0) translateY(100px);
        text-align: center;
      }

      .status-toast.show {
        transform: translateX(0) translateY(0);
      }
    }

    /* Large desktop */
    @media (min-width: 1024px) {
      .container {
        padding: 80px 24px;
      }

      .headline-display {
        font-size: 64px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="location-row">
      <span class="location-label">Your location</span>
      <div class="country-wrapper">
        <select class="country-select" id="countrySelect" onchange="switchCountry()">
          <option value="">Loading...</option>
        </select>
        <span class="chevron"></span>
      </div>
    </div>

    <div class="headline-section">
      <div class="headline-display placeholder" id="headlineDisplay">Loading...</div>
      <div class="input-row">
        <div class="input-wrapper">
          <input type="text" class="headline-input" id="headlineInput" placeholder="Set a new headline" maxlength="500" autocomplete="off">
        </div>
        <button class="submit-btn" id="submitBtn" onclick="setHeadline()">Set Headline</button>
      </div>
    </div>

    <div class="divider"></div>

    <div class="recent-section">
      <h2>Recent Headlines</h2>
      <ul class="recent-list" id="recentList">
        <li class="empty-state">No headlines yet</li>
      </ul>
    </div>
  </div>

  <div class="status-toast" id="toast">Headline updated</div>

  <script>
    const countries = [
      "The World",
      "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria",
      "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan",
      "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia",
      "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica",
      "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt",
      "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon",
      "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana",
      "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel",
      "Italy", "Ivory Coast", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kosovo", "Kuwait",
      "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
      "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico",
      "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru",
      "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway", "Oman",
      "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal",
      "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe",
      "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia",
      "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
      "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey",
      "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu",
      "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
    ];

    let currentCountry = '';
    let myCountry = '';

    async function init() {
      populateCountries();

      try {
        const locationRes = await fetch('/api/location');
        const locationData = await locationRes.json();
        myCountry = locationData.country;
        currentCountry = myCountry;

        const select = document.getElementById('countrySelect');
        if (countries.includes(myCountry)) {
          select.value = myCountry;
        } else {
          const opt = document.createElement('option');
          opt.value = myCountry;
          opt.textContent = myCountry;
          select.insertBefore(opt, select.options[1]);
          select.value = myCountry;
        }

        await loadHeadline(currentCountry);
        await loadRecent(currentCountry);

        document.getElementById('headlineInput').focus();
      } catch (err) {
        console.error('Init error:', err);
        document.getElementById('headlineDisplay').textContent = 'Unable to load';
      }
    }

    function populateCountries() {
      const select = document.getElementById('countrySelect');
      select.innerHTML = '';

      countries.forEach(country => {
        const opt = document.createElement('option');
        opt.value = country;
        opt.textContent = country;
        select.appendChild(opt);
      });
    }

    async function loadHeadline(country) {
      try {
        const res = await fetch(`/api/headline/${encodeURIComponent(country)}`);
        const data = await res.json();

        const display = document.getElementById('headlineDisplay');
        if (data.headline) {
          display.textContent = data.headline;
          display.classList.remove('placeholder');
        } else {
          display.textContent = 'No headline set';
          display.classList.add('placeholder');
        }
      } catch (err) {
        console.error('Load headline error:', err);
      }
    }

    async function loadRecent(country) {
      try {
        const res = await fetch(`/api/recent/${encodeURIComponent(country)}`);
        const data = await res.json();

        const list = document.getElementById('recentList');

        if (!data.recent || data.recent.length === 0) {
          list.innerHTML = '<li class="empty-state">No headlines yet</li>';
          return;
        }

        list.innerHTML = data.recent.map(item => `
          <li class="recent-item">
            <div class="recent-content">
              <div class="recent-headline">${escapeHtml(item.headline)}</div>
            </div>
            <div class="recent-time">${formatTime(item.timestamp)}</div>
          </li>
        `).join('');
      } catch (err) {
        console.error('Load recent error:', err);
      }
    }

    function switchCountry() {
      const select = document.getElementById('countrySelect');
      currentCountry = select.value;
      loadHeadline(currentCountry);
      loadRecent(currentCountry);
    }

    async function setHeadline() {
      const input = document.getElementById('headlineInput');
      const headline = input.value.trim();

      if (!headline) return;

      const btn = document.getElementById('submitBtn');
      btn.disabled = true;

      try {
        const res = await fetch(`/api/headline/${encodeURIComponent(currentCountry)}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ headline })
        });

        if (res.ok) {
          const data = await res.json();
          const display = document.getElementById('headlineDisplay');
          display.textContent = data.headline;
          display.classList.remove('placeholder');
          input.value = '';
          showToast('Headline updated');
          await loadRecent(currentCountry);
        }
      } catch (err) {
        console.error('Set headline error:', err);
        showToast('Error updating headline');
      }

      btn.disabled = false;
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function formatTime(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;

      if (diff < 60000) return 'Just now';
      if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
      if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;
      if (diff < 604800000) return `${Math.floor(diff / 86400000)}d ago`;

      return new Date(timestamp).toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric'
      });
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('headlineInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') setHeadline();
      });
    });

    init();
  </script>
</body>
</html>
